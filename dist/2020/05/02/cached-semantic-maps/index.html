<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Cached Semantic Maps: An Introduction | Vaishnav</title><meta name="description" content="A quick view into my work and passions. "><meta itemprop="name" content="Vaishnav S Menon"><meta itemprop="description" content="A quick view into my work and passions. "><meta itemprop="image" content="/assets/posts/cached-semantic-maps/cached-semantic-maps.jpg"><meta property="og:url" content="/2020/05/02/cached-semantic-maps/"><meta property="og:type" content="website"><meta property="og:title" content="Cached Semantic Maps: An Introduction | Vaishnav"><meta property="og:site_name" content="Vaishnav"><meta property="og:description" content="A quick view into my work and passions. "><meta property="og:image" content="/assets/posts/cached-semantic-maps/cached-semantic-maps.jpg"><meta name="twitter:url" content="/2020/05/02/cached-semantic-maps/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Cached Semantic Maps: An Introduction | Vaishnav"><meta name="twitter:site" content="Vaishnav"><meta name="twitter:description" content="A quick view into my work and passions. "><meta property="twitter:image" content="/assets/posts/cached-semantic-maps/cached-semantic-maps.jpg"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="Vaishnav" href="/feed.xml"><link rel="canonical" href="/2020/05/02/cached-semantic-maps/"> <script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/efe9d905ef3957d3a47927302/4a9b53c46068564a3bed98fde.js");</script></head><body id="cached-semantic-maps-an-introduction" class="post-layout"><header class="header"> <a class="header__title" href="/">Vaishnav</a><nav><ul class="header__list"><li class="hidden_sm"><a href="/">Home</a></li><li><a href="/posts">All Posts</a></li><li class="mini__only"><a id="header__tags" href="#" >Tags</a></li><li class="hidden_sm"><a href="/tag/projects">Projects</a></li><li class="hidden_sm"><a href="/tag/entrepreneurship">Entrepreneurship</a></li><li class="hidden_sm"><a href="/tag/thoughts">Thoughts</a></li><li><span class="popup__open">Contact</span></li></ul><ul id="header__menu" class="header__menu mini__only hidden"><li><a href="/tag/projects">Projects</a></li><li><a href="/tag/entrepreneurship">Entrepreneurship</a></li><li><a href="/tag/thoughts">Thoughts</a></li></ul></nav><script> var onTagClick = (e)=>{ e.preventDefault(); if(document.getElementById("header__menu").classList.contains('hidden')){ document.getElementById("header__menu").classList.remove('hidden'); } else { document.getElementById("header__menu").classList.add('hidden') } // Debounce document.getElementById('header__tags').onclick = null; setTimeout(()=>{ document.getElementById('header__tags').onclick = onTagClick; }, 100); }; document.getElementById('header__tags').onclick = onTagClick; </script></header><main><header class="header"> <a class="header__title" href="/">Vaishnav</a><nav><ul class="header__list"><li class="hidden_sm"><a href="/">Home</a></li><li><a href="/posts">All Posts</a></li><li class="mini__only"><a id="header__tags" href="#" >Tags</a></li><li class="hidden_sm"><a href="/tag/projects">Projects</a></li><li class="hidden_sm"><a href="/tag/entrepreneurship">Entrepreneurship</a></li><li class="hidden_sm"><a href="/tag/thoughts">Thoughts</a></li><li><span class="popup__open">Contact</span></li></ul><ul id="header__menu" class="header__menu mini__only hidden"><li><a href="/tag/projects">Projects</a></li><li><a href="/tag/entrepreneurship">Entrepreneurship</a></li><li><a href="/tag/thoughts">Thoughts</a></li></ul></nav><script> var onTagClick = (e)=>{ e.preventDefault(); if(document.getElementById("header__menu").classList.contains('hidden')){ document.getElementById("header__menu").classList.remove('hidden'); } else { document.getElementById("header__menu").classList.add('hidden') } // Debounce document.getElementById('header__tags').onclick = null; setTimeout(()=>{ document.getElementById('header__tags').onclick = onTagClick; }, 100); }; document.getElementById('header__tags').onclick = onTagClick; </script></header><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Cached Semantic Maps: An Introduction</h2><time class="post__date" datetime="2020-05-02T00:00:00+05:30" itemprop="datePublished">2 May 2020</time><ul class="post__topics"><li class="post__topics__item">C++</li><li class="post__topics__item">Data Structures</li><li class="post__topics__item">Caching</li></ul></div></div><div class="post__img"><div><figure class="absolute-bg" style="background-image: url('/assets/posts/cached-semantic-maps/cached-semantic-maps.jpg');"></figure></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><p>Right, I know what you’re thinking. <em>Cached Semantic Maps? Pfft, sounds pretentious</em>. And you know what? I agree. I don’t think this is a data structure that has many practical benefits. But I think it’s a cool idea, and no amount of <em>practicality</em> is going to stand in my way when it comes to cool ideas.</p><h3 id="some-background">Some Background</h3><p>I made this idea up when I was attending a training session at my Morgan Stanley internship during the summers of 2019. It was a brief intro into how programming was <em>really</em> used in industry, where they asked us questions of increasing difficulty, and we were to propose interesting solutions. Finally, they formed us into groups of four and pitched this question—</p><h4 id="make-a-data-structure-that-can-store-and-query-the-data-from-a-cricket-tournament">Make a data structure that can store and query the data from a cricket tournament.</h4><p>The first idea that everyone would think of, of course, is to store the data in a class or hashmap or something similar. For example, we thought of representing each match as a class and store the matches in an array. We found out very quickly that this is a bad idea—for every type of query except of the form “What is this stat of this match,” you’d have to either go through all the data points within a particular match, or (worse) data points within each of the matches.</p><p>We started thinking of ways to fix this. We thought of a couple of approaches:</p><ol><li>Store every stat (say runs till now, average speed, etc) in a hashmap. This would give us O(1) queries and possibly O(1) updates. However, this left our model completely inflexible. If anyone wanted to query something we hadn’t designed, it was pretty much impossible.</li><li>Segregate the data into two kinds—culumative and individual. Store all the individual data points in a balanced tree, and store all the cumulative points in a hashmap. This way, we can easily do queries like a maximum, minimum, etc in O(log(n)) time, and get cumulative data points in O(1) time. For crazy queries, we could simply do it in a brute force manner, although this would be costly.</li></ol><p>To be fair, this second solution was <em>good enough</em>, even for us at the time. However, we found that many other teams also got to this conclusion. We were students at our first internship. We wanted to stand out and be good bois and gals. So, half out of panic and half of ambition, we proposed</p><h3 id="the-cached-semantic-map">The Cached Semantic Map</h3><p>We noticed something very peculiar about this kind of system. Most of the times, when a match is ongoing, there’s a very limited number of things someone would want to query. Maybe something about the previous average stats of the players, maybe something about the current status of the game, etc. More complex queries are much more common in between games, where updates are rare. This lead us to our Aha! moment—we can have complex queries take any amount of time because we can cache the results! We couldn’t cache in the previous scenario because updates (which are very frequent during a game) would invalidate the cache. But this changed the way we approached the problem. Now, we had to build a data structure which:</p><ol><li>Is able to update relatively quickly, while at the same time being able to query a limited set of pre-decided queries quickly, and</li><li>Is able to handle complex queries (the more expressive the better), and</li><li>Is able to cache results for the complex queries.</li></ol><p>We proposed a system which would store the basic components of the game (details of balls, players, etc) as a <strong>semantic map</strong>, which is basically a graph where each node was of a certain type (say “team” or “ball”), and each edge contained information which was relevant to the objects connected. We then explained the need for and the viability of a cache, and the system of balanced trees we could use to store more common answers for when the game was ongoing. With that, we were done.</p><h3 id="actually-building-it">Actually Building It</h3><p>I started thinking about this recently because I started doing some competitive coding. I suddenly realized that this is actually quite a challenging data structure to implement, and what seemed like a simple solution at the time would probably be <em>really</em> challenging to build in reality.</p><p>…so I decided that it’d be fun to try and make it.</p><h1 id="thinking-about-the-queries">Thinking about the queries</h1><p>When I started thinking about it, I couldn’t really pin down <em>what</em> I’d have to do to do various things. I thought that this is probably because the system wasn’t really explained thoroughly, and I decided that a good place to start would be to understand the queries that we’d support. And what better way to do this than to lay out the rules for the querying language?</p><p>The steps now were simple. Think about the types of queries you’d need, categorize them and try to find similarities, and then specify how the program would expect these groupings.</p><h3 id="what-kind-of-queries-are-there">What kind of queries are there?</h3><p>The entire point of this project was to make really extendible querying. To this end, we need to allow a general querying paradigm.</p><p>Let’s consider different kinds of entities which exist in this system: Balls, Players, Matches, and Teams. There are relations between them, and we can think of them as connections between them.</p><p>Now, it should be clear that data is available at two levels: at each of these entities (Nodes), and at the edges between them. For example, a player may be 24 years old, and a match may be held on 29th February, 2019. However, the position of the player in the match can’t be a property of either the match or the player. It is instead a property of the connection between them.</p><p>We can take advantage of this structure to make our querying language.</p><p>Let us consider a couple example queries:</p><h4 id="what-is-the-age-of-a-player-named-vaishnav-from-the-team-kerala-karelas">What is the age of a player named “Vaishnav” from the team “Kerala Karelas?”</h4><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  from: 'players', 
  select: [
    {
      field: 'age'
    }
  ],
  extends: [
    {
      query: {
        from: 'teams',
        select: [
          {
            field: 'name',
            as: 'team_names'
          }
        ]
      },
      select: [
        {
          field: 'team_names',
        }
      ]
    }
  ],
  where: [
    {
      field: 'name',
      operation: 'equals',
      value: 'vaishnav',
    },
    {
      field: 'team',
      operation: 'contains',
      value: 'Kerala Karelas'
    }
  ]
}
</code></pre></div></div><h4 id="what-is-the-total-runs-of-all-players-named-vaishnav">What is the total runs of all players named “Vaishnav?”</h4><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  from: 'players', 
  select: [
    {
      field: 'runs',
      compute: 'sum',
      as: 'sum_runs'
    }
  ],
  extends: [
    {
      query: {
        from: 'balls',
      },
      select: [
        {
          field: 'runs',
        } 
      ]
    }
  ],
  where: [
    {
      field: 'name',
      operation: 'equals',
      value: 'vaishnav',
    },
  ]
}
</code></pre></div></div><p>Do remember that this syntax is completely made up!</p><h3 id="the-query-structure">The Query Structure</h3><p>From these examples, we get a simple query structure. Each query has 4 parts: select, from, extends, and where (inspired from SQL).</p><ul><li>From simply contains the type of node we are trying to select. This is a string.</li><li>Where contains a list of fields of the form {field, operation, value}, which filters the limits which are selected</li><li>Select ‘exposes’ the values from all the available data to the layer before it (or to whoever called the engine).</li><li>Extends is where a majority of the functionality lies. It allows you to extend the query to other nodes. You do this by specifying the query in the query field (instead of a from field), and the select, from, and where operate on the connection between the two nodes.</li></ul><p>A couple notes:</p><ul><li>Data exposed by extended fields are aggregated into an array, unless they are explicitly changed by a compute query.</li><li>All exposed fields are added to the available fields at the level just below it. Only fields explicitly exposed are shown to further layers. However, if there are fields of the same name in the list of names available at the node/connection level and in the list exposed from one layer up, we get undefined behaviour. This should be reported during compile time and disallowed!</li></ul><h3 id="query-compilation">Query Compilation</h3><p>Queries will have to be ‘compiled’ into a standard format. This is because we want, for example, queries different names but the same ‘idea’ to result in a cache hit! How this is to be done remains to be seen for now. Watch this space!</p></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=/2020/05/02/cached-semantic-maps/" target="_blank"><i class="fab fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Cached Semantic Maps: An Introduction+/2020/05/02/cached-semantic-maps/+by+Vaishnav" target="_blank"><i class="fab fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=/2020/05/02/cached-semantic-maps/" target="_blank"><i class="fab fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Cached Semantic Maps: An Introduction&summary=&url=/2020/05/02/cached-semantic-maps/" target="_blank"><i class="fab fa-linkedin"></i></a></li><li><a href="https://www.reddit.com/submit?url=/2020/05/02/cached-semantic-maps/" target="_blank"><i class="fab fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=/2020/05/02/cached-semantic-maps/" target="_blank"><i class="fab fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=/assets/posts/cached-semantic-maps/cached-semantic-maps.jpg&url=/2020/05/02/cached-semantic-maps/" target="_blank"><i class="fab fa-pinterest"></i></a></li></ul></div></div><div class="section-padding--none"><div class="grid"><hr class="sep"/></div></div><div class="section-padding"><div class="grid-small"> <span class="post__author">by Vaishnav</span><p class="post__bio"></p></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title">Related</h2><div class="related__container"><article class="related__post"> <a class="related__link" href="/2020/05/02/cached-semantic-maps/"><figure class="related__img"> <img src="/assets/posts/cached-semantic-maps/cached-semantic-maps.jpg" alt="Cached Semantic Maps: An Introduction"/></figure><div><h2 class="related__text">Cached Semantic Maps: An Introduction</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><div class="footer__container"><ul class="footer__social"><li><a href="https://www.linkedin.com/in/vaishnavsm/" target="_blank"><i class="fab fa-linkedin"></i></a></li><li><a href="https://github.com/vaishnavsm" target="_blank"><i class="fab fa-github"></i></a></li><li><a href="https://twitter.com/_vaishnavsm_" target="_blank"><i class="fab fa-twitter"></i></a></li><li><a href="https://www.instagram.com/_vaishnavsm_/" target="_blank"><i class="fab fa-instagram"></i></a></li></ul><hr class="sep--white"/><ul class="footer__tags"><li><a class="footer__link" href="/tag/projects">Projects</a></li><li><a class="footer__link" href="/tag/featured">Featured</a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/contact_us.jpg);"><div style="text-decorations: none; text-align: right; right: 0; bottom: 0; position: absolute; font-size: 10px;"> Photo by <strong><a style="text-decorations: none; color: black; "href="https://www.pexels.com/@scottwebb?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels">Scott Webb</a></strong> from Pexels</div></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__mast section-padding--half"><ul style="display: flex; flex-direction: column; align-items: stretch;"><li style="display: flex; justify-content: space-between; flex-wrap: wrap;"> <span style="padding-right: 10px; flex-grow: 1; text-align: left; flex-basis: 0;"> Consulting: </span> <a style="color: #222222; flex-grow: 1; text-align: left; flex-basis: 0;" href="mailto://consulting@vaishnavsm.com" target="_blank">consulting@vaishnavsm.com</a></li><li style="display: flex; justify-content: space-between; flex-wrap: wrap;"> <span style="padding-right: 10px; flex-grow: 1; text-align: left; flex-basis: 0;"> Feedback: </span> <a style="color: #222222; flex-grow: 1; text-align: left; flex-basis: 0;" href="mailto://feedback@vaishnavsm.com" target="_blank">feedback@vaishnavsm.com</a></li><li style="display: flex; justify-content: space-between; flex-wrap: wrap;"> <span style="padding-right: 10px; flex-grow: 1; text-align: left; flex-basis: 0;"> Otherwise: </span> <a style="color: #222222; flex-grow: 1; text-align: left; flex-basis: 0;" href="mailto://me@vaishnavsm.com" target="_blank">me@vaishnavsm.com</a></li></ul></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"><p style="text-align: justify;"> <br /> I'm always available to discuss technical consulting projects, interesting tech, or other projects. If you want to contact me for this, <a href="mailto://consulting@vaishnavsm.com" target="_blank" style="color: #555555"> emailing at consulting@vaishnavsm.com </a> is the best way to reach me. Do note that if you email me for other purposes on this id, your email id will automatically be filtered out thenceforth (wow)<br /> <br /> I'm always looking for feedback regarding anything I can improve. If you have pointers on how I can improve, please mail me at <a href="mailto://feedback@vaishnavsm.com" target="_blank" style="color: #555555"> emailing at feedback@vaishnavsm.com </a>. Thanks! <br /> <br /> If you just want to say hi, or just chat for funsies, hmu on <a href="https://www.instagram.com/_vaishnavsm_/" target="_blank" style="color: #555555"> instagram </a> . That's what I check when I'm free and in a conversing mood &#x1F680;.</p><div id="form"></div></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  